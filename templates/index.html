<!DOCTYPE html>
<html lang="si">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>GHOST VPN</title> <!-- නම වෙනස් කර ඇත -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Fonts: Roboto Mono (Hacker Font) -->
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
/* ===== BASE (New "Hacker Green" Theme) ===== */
:root {
  --bg-color: #000000;
  --panel-color: rgba(0, 20, 0, 0.7); /* Hacker Green + transparency */
  --border-color: rgba(0, 255, 0, 0.4);
  --accent-green: #00ff00; /* Matrix Green */
  --text-color: #ffffff;
  --text-muted: #a0a0b0;
  --font-ui: 'Roboto Mono', monospace; /* හැමදේම Monospace */
  --font-data: 'Roboto Mono', monospace;
}

*{margin:0;padding:0;box-sizing:border-box;}

body{
  font-family: var(--font-ui); /* Hacker Font එක default කළා */
  background-color: var(--bg-color);
  color: var(--text-color);
  overflow-x:hidden;
  display:flex;
  flex-direction:column;
  min-height:100vh;
}

/* ===== "NEURO-WEB" ANIMATED CANVAS BACKGROUND (මේක තියාගත්තා) ===== */
#neuro-canvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
  opacity: 0.4; /* පොඩ්ඩක් opacity වැඩි කළා */
}

/* ===== CONTAINER ===== */
.container{
  position:relative;
  z-index: 2; /* Canvas එකට උඩින් */
  max-width:1300px; 
  margin:auto;
  padding:40px 20px;
  flex:1;
}

/* ===== TITLE (Hacker Style) ===== */
h2{
  text-align:center;
  font-size: 38px;
  font-weight: 700;
  letter-spacing: 2px;
  margin-bottom: 50px;
  color: var(--accent-green); /* කොළ පාට කළා */
  text-shadow: 0 0 10px var(--accent-green); /* Glow effect */
  position:relative;
  text-transform: uppercase;
}

/* ===== GRID (3x2 Layout - තියාගත්තා) ===== */
.grid{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 25px;
}
@media(max-width: 1024px){
  .grid {
    grid-template-columns: repeat(2, 1fr);
  }
}
@media(max-width: 700px){
  .grid {
    grid-template-columns: 1fr;
  }
}

/* ===== CARD (Hacker Terminal Style) ===== */
.card{
  position:relative;
  padding: 25px;
  border-radius: 0px; /* Sharp Corners */
  overflow:hidden;
  background: var(--panel-color);
  backdrop-filter: blur(5px); /* පොඩි blur එකක් */
  border: 1px solid var(--border-color);
  box-shadow: 0 0 15px 0 rgba(0, 255, 0, 0.2); /* Green Glow */
  transition: all 0.3s ease;
  z-index: 1; 
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 0 25px 0 rgba(0, 255, 0, 0.5);
  border-color: var(--accent-green);
}

.card > *{position:relative;z-index: 3;}

/* ===== CARD CONTENT (Hacker Style) ===== */
.card h3{
  display:flex;align-items:center;gap:10px;
  font-size: 18px; 
  font-weight: 600;
  color: var(--accent-green); /* කොළ පාට කළා */
  margin-bottom: 20px;
  text-transform: uppercase;
}
.card h3 i{
  color: var(--accent-green); /* Icon පාට වෙනස් කළා */
}

.card form{display:flex; flex-direction: column; gap:15px;}

.card input[type="text"]{
  width: 100%;
  padding: 12px 15px;
  border-radius: 0px; /* Sharp Corners */
  border: 1px solid var(--border-color);
  background: rgba(0,0,0,0.2);
  color: var(--text-color);
  font-family: var(--font-ui);
  font-size: 14px;
  outline: none;
  transition: border-color 0.3s, box-shadow 0.3s;
}
.card input[type="text"]:focus{
  border-color: var(--accent-green);
  box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
}

/* Button Styles (Green - Hacker Style) */
.card button{
  border: none; 
  padding: 12px 20px;
  border-radius: 0px; /* Sharp Corners */
  font-weight:700;
  font-family: var(--font-ui);
  cursor:pointer;
  transition: all 0.3s;
  text-transform: uppercase;
  font-size: 14px;
  background: var(--accent-green); /* කොළ පාට */
  color: var(--bg-color); /* අකුරු කළු කළා */
}
.card button:hover {
  background: #fff;
  color: #000;
  box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
}

/* Ping Button (Outline Style) */
.card button.outline {
  background: transparent;
  border: 2px solid var(--accent-green);
  color: var(--accent-green);
}
.card button.outline:hover {
  background: var(--accent-green);
  color: var(--bg-color);
  box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
}


/* ===== PROGRESS (Horizontal Bars - Hacker Style) ===== */
.progress-container {
  background: rgba(0,0,0,0.2);
  border-radius: 0px; /* Sharp Corners */
  height: 8px;
  margin-top: 6px;
  overflow: hidden;
  border: 1px solid var(--border-color);
}
.progress-bar {
  height: 100%;
  background: var(--accent-green); /* කොළ පාට */
  width: 0%; /* JS වලින් set වෙයි */
  border-radius: 0px;
  transition: width 0.5s ease;
  box-shadow: 0 0 10px var(--accent-green); /* Glow */
}
.progress-label {
  display: flex;
  justify-content: space-between;
  font-size: 14px;
  margin-top: 10px;
}
.progress-label .value {
  font-family: var(--font-data);
  color: var(--text-color);
}
.progress-label .label {
  color: var(--text-muted);
}


/* ===== STATUS (Hacker Style) ===== */
.status-item {
  margin-top: 10px;
  font-size: 14px;
  color: var(--text-muted);
  display: flex;
  align-items: center;
  gap: 8px;
}
.status-item strong, .ping-result {
  color: var(--text-color);
  font-weight: 500;
  font-family: var(--font-data);
}
#download-traffic, #upload-traffic {
  font-family: var(--font-data);
  font-size: 1.1em;
  color: var(--accent-green); /* කොළ පාට කළා */
}


/* ===== SAFEGUARD (Hacker Style) ===== */
.safeguard-bubble{
  border: 1px solid var(--accent-green);
  border-radius: 0px; /* Sharp Corners */
  text-align:center;
  padding:25px;
  background: rgba(0, 255, 0, 0.1);
  transition:all 0.3s;
  opacity: 0.8;
}
.safeguard-bubble:hover {
  opacity: 1;
  background: rgba(0, 255, 0, 0.2);
}
.safeguard-bubble i{
  font-size: 32px;
  color: var(--accent-green);
  margin-bottom: 12px;
}

/* ===== FOOTER ===== */
.footer{
  text-align:center;
  padding: 40px 20px;
  font-size: 14px;
  color: var(--text-muted);
  border-top: 1px solid var(--border-color);
  margin-top: 25px;
}
.social-icons a{
  color: var(--text-muted);
  margin:0 10px;
  font-size: 20px;
  transition:all 0.3s;
}
.social-icons a:hover{
  color: var(--accent-green);
  text-shadow: 0 0 10px var(--accent-green);
}
</style>
</head>
<body>
  
  <!-- "NEURO-WEB" ANIMATED CANVAS BACKGROUND (තියාගත්තා) -->
  <canvas id="neuro-canvas"></canvas>
  
  <div class="container">
    
    <h2>GHOST VPN</h2> <!-- ":: TERMINAL" අයින් කළා -->

    <!-- NEW 3x2 GRID LAYOUT (පින්තූරයට අනුව) -->
    <div class="grid">
      
      <!-- Card 1: User Name -->
      <div class="card">
        <h3><i class="fas fa-terminal"></i>User Access</h3>
        <form id="user-form" action="/usage" method="POST">
          <input type="text" name="user_input" placeholder="Enter User Name" required />
          <button type="submit">Check Usage</button>
        </form>
      </div>

      <!-- Card 2: Server Usage (Horizontal Bars) -->
      <div class="card">
        <h3><i class="fas fa-server"></i>Core Vitals</h3>
        <!-- CPU -->
        <div class="progress-label">
          <span class="label">CPU:</span>
          <span class="value" id="cpu-usage">--%</span>
        </div>
        <div class="progress-container">
          <div class="progress-bar" id="cpu-progress"></div>
        </div>
        <!-- Memory -->
        <div class="progress-label" style="margin-top: 15px;">
          <span class="label">Memory:</span>
          <span class="value" id="memory-usage">--%</span>
        </div>
        <div class="progress-container">
          <div class="progress-bar" id="memory-progress"></div>
        </div>
        <!-- Disk -->
        <div class="progress-label" style="margin-top: 15px;">
          <span class="label">Disk:</span>
          <span class="value" id="disk-usage">--%</span>
        </div>
        <div class="progress-container">
          <div class="progress-bar" id="disk-progress"></div>
        </div>
      </div>
      
      <!-- Card 3: Ping Test -->
      <div class="card">
         <h3><i class="fas fa-wifi"></i>Network Ping</h3>
        <button id="ping-button" type="button" class="outline">Ping Server</button>
        <div class="ping-result" id="ping-result" style="margin-top: 15px;">Ping: -</div>
        <div class="status-item"><i class="fas fa-map-marker-alt"></i> Location: <strong id="server-location">--</strong></div>
        <div class="status-item"><i class="fas fa-heartbeat"></i> Status: <strong id="server-status">Online</strong></div>
      </div>

      <!-- Card 4: Network Traffic -->
      <div class="card">
        <h3><i class="fas fa-exchange-alt"></i>Data Stream</h3>
        <p style="font-size: 16px;">Download: <strong id="download-traffic">-- Mbps</strong></p>
        <p style="font-size: 16px; margin-top: 10px;">Upload: <strong id="upload-traffic">-- Mbps</strong></p>
      </div>
      
      <!-- Card 5: Cloud Provider -->
      <div class="card">
        <h3><i class="fas fa-cloud"></i>Host Provider</h3>
        <p style="font-size: 16px; margin-top: 10px;">Hosted on: <strong id="cloud-provider">Detecting...</strong></p>
      </div>
      
      <!-- Card 6: Server Safeguard -->
      <div class="card">
        <h3><i class="fas fa-shield-alt"></i>Firewall</h3>
        <div class="safeguard-bubble">
          <i class="fas fa-lock"></i><br>
          <span>Active Firewall & DDoS Protection</span>
        </div>
      </div>

    </div>
    <!-- End of Grid -->

    <div class="footer">
      <p>&copy; 2025 GHOST VPN. All rights reserved.</p>
      <div class="social-icons">
        <a href="https://github.com/Tyga-x/Traffic-X" target="_blank"><i class="fab fa-github"></i></a>
      </div>
    </div>
  </div>

  <script>
    // ===== "NEURO-WEB" ANIMATED CANVAS SCRIPT (HACKER GREEN THEME) =====
    const canvas = document.getElementById('neuro-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let particlesArray;
    let mouse = {
      x: null,
      y: null,
      radius: (canvas.height / 120) * (canvas.width / 120)
    };

    window.addEventListener('mousemove', function(event) {
      mouse.x = event.x;
      mouse.y = event.y;
    });
    window.addEventListener('mouseout', function() {
      mouse.x = null;
      mouse.y = null;
    });

    // Particle class
    class Particle {
      constructor(x, y, directionX, directionY, size, color) {
        this.x = x;
        this.y = y;
        this.directionX = directionX;
        this.directionY = directionY;
        this.size = size;
        this.color = color;
      }
      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2, false);
        ctx.fillStyle = this.color;
        ctx.fill();
      }
      update() {
        if (this.x > canvas.width || this.x < 0) {
          this.directionX = -this.directionX;
        }
        if (this.y > canvas.height || this.y < 0) {
          this.directionY = -this.directionY;
        }
        
        let dx = mouse.x - this.x;
        let dy = mouse.y - this.y;
        let distance = Math.sqrt(dx * dx + dy * dy);
        if (distance < mouse.radius + this.size) {
          if (mouse.x < this.x && this.x < canvas.width - this.size * 10) {
            this.x += 5;
          }
          if (mouse.x > this.x && this.x > this.size * 10) {
            this.x -= 5;
          }
          if (mouse.y < this.y && this.y < canvas.height - this.size * 10) {
            this.y += 5;
          }
          if (mouse.y > this.y && this.y > this.size * 10) {
            this.y -= 5;
          }
        }
        this.x += this.directionX;
        this.y += this.directionY;
        this.draw();
      }
    }

    // Create particle array
    function init() {
      particlesArray = [];
      let numberOfParticles = (canvas.height * canvas.width) / 9000;
      for (let i = 0; i < numberOfParticles; i++) {
        let size = (Math.random() * 1.5) + 0.5;
        let x = (Math.random() * ((canvas.width - size * 2) - (size * 2)) + size * 2);
        let y = (Math.random() * ((canvas.height - size * 2) - (size * 2)) + size * 2);
        let directionX = (Math.random() * 0.4) - 0.2;
        let directionY = (Math.random() * 0.4) - 0.2;
        let color = 'rgba(0, 255, 0, 0.5)'; // **COLOR CHANGED TO GREEN**
        particlesArray.push(new Particle(x, y, directionX, directionY, size, color));
      }
    }

    // Connect particles
    function connect() {
      let opacityValue = 1;
      for (let a = 0; a < particlesArray.length; a++) {
        for (let b = a; b < particlesArray.length; b++) {
          let distance = ((particlesArray[a].x - particlesArray[b].x) * (particlesArray[a].x - particlesArray[b].x))
                       + ((particlesArray[a].y - particlesArray[b].y) * (particlesArray[a].y - particlesArray[b].y));
          if (distance < (canvas.width / 7) * (canvas.height / 7)) {
            opacityValue = 1 - (distance / 20000);
            let colorA = 'rgba(0, 255, 0,' + opacityValue + ')'; // **COLOR A CHANGED TO GREEN**
            let colorB = 'rgba(0, 150, 0,' + opacityValue + ')'; // **COLOR B CHANGED TO DARK GREEN**
            ctx.strokeStyle = (a % 2 === 0) ? colorA : colorB;
            ctx.lineWidth = 0.5;
            ctx.beginPath();
            ctx.moveTo(particlesArray[a].x, particlesArray[a].y);
            ctx.lineTo(particlesArray[b].x, particlesArray[b].y);
            ctx.stroke();
          }
        }
      }
    }

    // Animation loop
    function animate() {
      requestAnimationFrame(animate);
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let i = 0; i < particlesArray.length; i++) {
        particlesArray[i].update();
      }
      connect();
    }
    
    window.addEventListener('resize', function() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      mouse.radius = (canvas.height / 120) * (canvas.width / 120);
      init();
    });

    init();
    animate();
    // ===== END OF CANVAS SCRIPT =====


    // ===== Dashboard Data Script =====
    const baseUrl = window.location.origin;

    // Ping logic
    document.getElementById("ping-button").addEventListener("click", async () => {
      const start = Date.now();
      const result = document.getElementById("ping-result");
      result.textContent = "Pinging...";
      result.style.fontFamily = "var(--font-data)";

      try {
        const res = await fetch(baseUrl + "/ping");
        if (!res.ok) throw new Error(`Server responded ${res.status}`);
        const latency = Date.now() - start;
        result.textContent = `Ping: ${latency} ms`;
      } catch (e) {
        result.textContent = "Ping failed";
      }
    });

    // ===== Server data (Horizontal Bar Logic) =====
    setInterval(async () => {
      try {
        const res = await fetch(baseUrl + "/server-status");
        if (!res.ok) {
            throw new Error(`Server responded with ${res.status}`);
        }
        
        const data = await res.json();
        
        if (data && data.cpu !== undefined && data.ram !== undefined && data.disk !== undefined) {
            document.getElementById("cpu-usage").textContent = `${data.cpu.toFixed(1)}%`;
            document.getElementById("memory-usage").textContent = `${data.ram.toFixed(1)}%`;
            document.getElementById("disk-usage").textContent = `${data.disk.toFixed(1)}%`;

            // **NEW: Update width for horizontal bars**
            document.getElementById("cpu-progress").style.width = `${data.cpu}%`;
            document.getElementById("memory-progress").style.width = `${data.ram}%`;
            document.getElementById("disk-progress").style.width = `${data.disk}%`;

        } else {
            throw new Error("Invalid data structure from server");
        }
      } catch (e) {
        document.getElementById("cpu-usage").textContent = `--%`;
        document.getElementById("memory-usage").textContent = `--%`;
        document.getElementById("disk-usage").textContent = `--%`;
        document.getElementById("cpu-progress").style.width = `0%`;
        document.getElementById("memory-progress").style.width = `0%`;
        document.getElementById("disk-progress").style.width = `0%`;
      }
    }, 2000);
    // ===== End of FIX =====

    // Fetch server location
    (async () => {
      try {
        const res = await fetch(baseUrl + "/server-location");
        if (!res.ok) throw new Error(`Server responded ${res.status}`);
        const loc = await res.json();
        document.getElementById("server-location").textContent = `${loc.city}, ${loc.country}`;
      } catch (e) {
        document.getElementById("server-location").textContent = "Unavailable";
      }
    })();

    // Fetch cloud provider name
  (async () => {
    try {
      const res = await fetch(baseUrl + "/cloud-provider");
      if (!res.ok) throw new Error(`Server responded ${res.status}`);
      const data = await await res.json();
      document.getElementById("cloud-provider").textContent = data.provider || "Unknown";
    } catch (e) {
      document.getElementById("cloud-provider").textContent = "Unavailable";
    }
  })();

  // ===== Live Mbps (Download/Upload) =====
  async function refreshNet() {
    try {
      const r = await fetch(baseUrl + "/net-live");
      if (!r.ok) throw new Error(`Server responded ${r.status}`);
      const data = await r.json();
      if (data && data.total) {
        document.getElementById("download-traffic").textContent = data.total.rx_mbps.toFixed(2) + " Mbps";
        document.getElementById("upload-traffic").textContent   = data.total.tx_mbps.toFixed(2) + " Mbps";
      }
    } catch (e) {
      document.getElementById("download-traffic").textContent = "-- Mbps";
      document.getElementById("upload-traffic").textContent   = "-- Mbps";
    }
  }
  refreshNet();
  setInterval(refreshNet, 2000);
  
  </script>
</body>
</html>
